<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Formulário BPA - Vigilância Sanitária</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f6f8;
  padding: 20px;
}
form {
  max-width: 900px;
  margin: auto;
  background: #fff;
  padding: 30px;
  border-radius: 8px;
}
.step { display: none; }
.step.active { display: block; }

h2 {
  border-left: 5px solid #0077ff;
  padding-left: 10px;
}
label {
  font-weight: bold;
  display: block;
  margin-top: 12px;
}
input, select {
  width: 100%;
  padding: 8px;
  margin: 6px 0 14px;
}

.buttons {
  display: flex;
  justify-content: space-between;
  margin-top: 20px;
  gap: 10px;
}

button {
  padding: 10px 22px;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}

.next { background: #0077ff; color: white; }
.prev { background: #ccc; }
.submit { background: #28a745; color: white; width: 100%; }
</style>
</head>

<body>
<form action="https://api.sheetmonkey.io/form/wzWe4jH5d9aZ2Dx3GJKqUk" method="POST">
  <input type="hidden" name="Created At" value="x-sheetmonkey-current-date-time">
  <input type="hidden" name="x-sheetmonkey-redirect" id="sm-redirect">
  <div id="sections"></div>
</form>

<script>
const sectionFiles = [
  "./00-intro.html",
  "./01-identificacao.html",
  "./02-cadastro.html",
  "./03-inspecao.html",
  "./04-licenciamento.html",
  "./05-investigacao.html",
  "./06-acoes-educativas.html",
  "./07-outros.html",
];

async function loadSections() {
  const container = document.getElementById('sections');

  for (const file of sectionFiles) {
    try {
      const response = await fetch(file);
      if (!response.ok) {
        console.error(`Erro ao carregar: ${file}`);
        continue;
      }
      const html = await response.text();
      container.insertAdjacentHTML('beforeend', html);
    } catch (err) {
      console.error(`Falha no fetch de ${file}`, err);
    }
  }

  const steps = document.querySelectorAll(".step");
  let currentStep = 0;

  function scrollToTop() {
    window.scrollTo({ top: 0, left: 0, behavior: "smooth" });
  }

  function showStep(index) {
    steps.forEach(s => s.classList.remove("active"));
    if (steps[index]) steps[index].classList.add("active");

    const submitBtn = document.querySelector(".submit");
    if (submitBtn) {
      submitBtn.style.display = (index === steps.length - 1) ? "block" : "none";
    }
  }

  showStep(currentStep);

  document.querySelectorAll(".next").forEach(btn => {
    btn.addEventListener("click", () => {
      const fields = steps[currentStep].querySelectorAll("input, select, textarea");

      for (let field of fields) {
        if (!field.checkValidity()) {
          field.reportValidity();
          if (currentStep === 1) {
            alert("Por favor, preencha todos os campos de identificação antes de prosseguir.");
          }
          return;
        }
      }

      if (currentStep < steps.length - 1) {
        currentStep++;
        showStep(currentStep);
        scrollToTop();
      }
    });
  });

  document.querySelectorAll(".prev").forEach(btn => {
    btn.addEventListener("click", () => {
      if (currentStep > 0) {
        currentStep--;
        showStep(currentStep);
        scrollToTop();
      }
    });
  });

  document.querySelector("form").addEventListener("keydown", e => {
    if (e.key === "Enter" && currentStep !== steps.length - 1) {
      e.preventDefault();
    }
  });
}

/* Botão: Painel gerência -> abre a página painel_gerencia.html */
document.addEventListener("click", (e) => {
  const btn = e.target.closest("#btnPainelGerencia");
  if (!btn) return;

  e.preventDefault();
  window.location.href = "painel_gerencia.html";
});

/* Redirect do SheetMonkey (voltar pro início) */
const sm = document.getElementById("sm-redirect");
if (sm) {
  sm.value = new URL("index.html", window.location.href).toString();
}

/* Carrega as seções por último */
loadSections();
</script>
</body>
</html>
